<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>常规部署 | jasvtfvan前端博客</title>
    <meta name="description" content="欢迎来到我的前端工厂">
    <link rel="icon" href="/fe-blog/github.ico">
    
    <link rel="preload" href="/fe-blog/assets/css/0.styles.68cfcd3e.css" as="style"><link rel="preload" href="/fe-blog/assets/js/app.8a3559bf.js" as="script"><link rel="preload" href="/fe-blog/assets/js/2.fbf19223.js" as="script"><link rel="preload" href="/fe-blog/assets/js/18.99786a0e.js" as="script"><link rel="prefetch" href="/fe-blog/assets/js/10.399f0c01.js"><link rel="prefetch" href="/fe-blog/assets/js/11.08202412.js"><link rel="prefetch" href="/fe-blog/assets/js/12.cfc10ac9.js"><link rel="prefetch" href="/fe-blog/assets/js/13.bdceb3a3.js"><link rel="prefetch" href="/fe-blog/assets/js/14.0c886dba.js"><link rel="prefetch" href="/fe-blog/assets/js/15.f5d42d2e.js"><link rel="prefetch" href="/fe-blog/assets/js/16.19c927b2.js"><link rel="prefetch" href="/fe-blog/assets/js/17.cc368339.js"><link rel="prefetch" href="/fe-blog/assets/js/19.2c96aa8f.js"><link rel="prefetch" href="/fe-blog/assets/js/20.feb358f9.js"><link rel="prefetch" href="/fe-blog/assets/js/21.854b8672.js"><link rel="prefetch" href="/fe-blog/assets/js/22.78adf0af.js"><link rel="prefetch" href="/fe-blog/assets/js/23.a8c123d2.js"><link rel="prefetch" href="/fe-blog/assets/js/24.65de2737.js"><link rel="prefetch" href="/fe-blog/assets/js/25.21f6581b.js"><link rel="prefetch" href="/fe-blog/assets/js/26.19b2e629.js"><link rel="prefetch" href="/fe-blog/assets/js/27.b0579100.js"><link rel="prefetch" href="/fe-blog/assets/js/28.a0c1bad8.js"><link rel="prefetch" href="/fe-blog/assets/js/29.3869f6fd.js"><link rel="prefetch" href="/fe-blog/assets/js/3.a5dd7d81.js"><link rel="prefetch" href="/fe-blog/assets/js/30.be6becb7.js"><link rel="prefetch" href="/fe-blog/assets/js/31.e027926c.js"><link rel="prefetch" href="/fe-blog/assets/js/32.dd112bea.js"><link rel="prefetch" href="/fe-blog/assets/js/33.2cdeb0bd.js"><link rel="prefetch" href="/fe-blog/assets/js/34.2eb22cbc.js"><link rel="prefetch" href="/fe-blog/assets/js/35.a1660bb3.js"><link rel="prefetch" href="/fe-blog/assets/js/36.3d49d679.js"><link rel="prefetch" href="/fe-blog/assets/js/37.2c728d3e.js"><link rel="prefetch" href="/fe-blog/assets/js/38.5b00cff3.js"><link rel="prefetch" href="/fe-blog/assets/js/39.bc2ccb29.js"><link rel="prefetch" href="/fe-blog/assets/js/4.54c72001.js"><link rel="prefetch" href="/fe-blog/assets/js/40.fe52d14c.js"><link rel="prefetch" href="/fe-blog/assets/js/41.da19c7de.js"><link rel="prefetch" href="/fe-blog/assets/js/42.82780c8a.js"><link rel="prefetch" href="/fe-blog/assets/js/43.ea864644.js"><link rel="prefetch" href="/fe-blog/assets/js/44.683e33ca.js"><link rel="prefetch" href="/fe-blog/assets/js/45.6ebdb1c6.js"><link rel="prefetch" href="/fe-blog/assets/js/46.d152d9d1.js"><link rel="prefetch" href="/fe-blog/assets/js/5.7519b52c.js"><link rel="prefetch" href="/fe-blog/assets/js/6.60bc9110.js"><link rel="prefetch" href="/fe-blog/assets/js/7.583a8196.js"><link rel="prefetch" href="/fe-blog/assets/js/8.b04d2cae.js"><link rel="prefetch" href="/fe-blog/assets/js/9.f4b536f6.js">
    <link rel="stylesheet" href="/fe-blog/assets/css/0.styles.68cfcd3e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fe-blog/" class="home-link router-link-active"><!----> <span class="site-name">jasvtfvan前端博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fe-blog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">微信平台</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>公众号</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/wechat/serviceaccount/local-debug.html" class="nav-link">本地调试</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">javascript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-blog/javascript/regexp/" class="nav-link">正则表达式</a></li><li class="dropdown-item"><!----> <a href="/fe-blog/javascript/highlights/" class="nav-link">基础集锦</a></li><li class="dropdown-item"><!----> <a href="/fe-blog/javascript/promise/" class="nav-link">promise</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">主流框架</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>vue2</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/frame/vue2/source/observer.html" class="nav-link">框架源码</a></li><li class="dropdown-subitem"><a href="/fe-blog/frame/vue2/application/base.html" class="nav-link">框架应用</a></li></ul></li><li class="dropdown-item"><h4>react</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/frame/react15/source/native.html" class="nav-link">react15源码</a></li><li class="dropdown-subitem"><a href="/fe-blog/frame/react16/source/fiber.html" class="nav-link">react16源码</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具环境</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/enviroment/tools/git/" class="nav-link">git/git-flow</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/tools/node/" class="nav-link">node工具</a></li></ul></li><li class="dropdown-item"><h4>系统</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/enviroment/os/centos/mnt.html" class="nav-link">centOS</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/os/centos/cmd.html" class="nav-link">linux常用命令</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/os/mac/switch-hosts.html" class="nav-link">mac技巧</a></li></ul></li><li class="dropdown-item"><h4>部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/normal/" class="nav-link router-link-exact-active router-link-active">常规部署</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/cicd/" class="nav-link">CI/CD</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/gitlab/" class="nav-link">gitlab搭建</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/docker/" class="nav-link">docker常用容器</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/cicd-pro/cicd.html" class="nav-link">CI/CD综合</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fe-blog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">微信平台</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>公众号</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/wechat/serviceaccount/local-debug.html" class="nav-link">本地调试</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">javascript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-blog/javascript/regexp/" class="nav-link">正则表达式</a></li><li class="dropdown-item"><!----> <a href="/fe-blog/javascript/highlights/" class="nav-link">基础集锦</a></li><li class="dropdown-item"><!----> <a href="/fe-blog/javascript/promise/" class="nav-link">promise</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">主流框架</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>vue2</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/frame/vue2/source/observer.html" class="nav-link">框架源码</a></li><li class="dropdown-subitem"><a href="/fe-blog/frame/vue2/application/base.html" class="nav-link">框架应用</a></li></ul></li><li class="dropdown-item"><h4>react</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/frame/react15/source/native.html" class="nav-link">react15源码</a></li><li class="dropdown-subitem"><a href="/fe-blog/frame/react16/source/fiber.html" class="nav-link">react16源码</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具环境</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/enviroment/tools/git/" class="nav-link">git/git-flow</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/tools/node/" class="nav-link">node工具</a></li></ul></li><li class="dropdown-item"><h4>系统</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/enviroment/os/centos/mnt.html" class="nav-link">centOS</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/os/centos/cmd.html" class="nav-link">linux常用命令</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/os/mac/switch-hosts.html" class="nav-link">mac技巧</a></li></ul></li><li class="dropdown-item"><h4>部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/normal/" class="nav-link router-link-exact-active router-link-active">常规部署</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/cicd/" class="nav-link">CI/CD</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/gitlab/" class="nav-link">gitlab搭建</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/docker/" class="nav-link">docker常用容器</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/cicd-pro/cicd.html" class="nav-link">CI/CD综合</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fe-blog/enviroment/deploy/normal/" class="active sidebar-link">常规部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_1-服务器购买与备案" class="sidebar-link">1. 服务器购买与备案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_1-1-购买域名" class="sidebar-link">1.1 购买域名</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_1-2-云主机" class="sidebar-link">1.2 云主机</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_1-3-购买服务器（阿里云）" class="sidebar-link">1.3 购买服务器（阿里云）</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_1-4-备案（阿里云）" class="sidebar-link">1.4 备案（阿里云）</a></li></ul></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_2-服务器部署" class="sidebar-link">2. 服务器部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_2-1-客户端工具" class="sidebar-link">2.1 客户端工具</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_2-2-连接服务器-心跳" class="sidebar-link">2.2 连接服务器(心跳)</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_2-3-创建非root用户" class="sidebar-link">2.3 创建非root用户</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_2-4-授予权限" class="sidebar-link">2.4 授予权限</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_2-5-添加sudo权限" class="sidebar-link">2.5 添加sudo权限</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_2-6-修改非root用户密码" class="sidebar-link">2.6 修改非root用户密码</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_2-7-ssh无密码登录" class="sidebar-link">2.7 SSH无密码登录</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_2-8-新服务器参考" class="sidebar-link">2.8 新服务器参考</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_2-9-安装软件" class="sidebar-link">2.9 安装软件</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_2-10-安装node" class="sidebar-link">2.10 安装node</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_2-11-编写node程序" class="sidebar-link">2.11 编写node程序</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_2-12-启动程序" class="sidebar-link">2.12 启动程序</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_2-13-nginx" class="sidebar-link">2.13 nginx</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_2-14-nginx常规配置参考" class="sidebar-link">2.14 nginx常规配置参考</a></li></ul></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_3-docker" class="sidebar-link">3. Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_3-1-docker版本" class="sidebar-link">3.1 docker版本</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_3-2-docker安装" class="sidebar-link">3.2 docker安装</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_3-3-启动docker" class="sidebar-link">3.3 启动docker</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_3-4-查看docker信息" class="sidebar-link">3.4 查看docker信息</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_3-5-docker架构" class="sidebar-link">3.5 Docker架构</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_3-6-阿里云加速" class="sidebar-link">3.6 阿里云加速</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_3-7-服务启动解析" class="sidebar-link">3.7 服务启动解析</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_3-8-启动node服务" class="sidebar-link">3.8 启动node服务</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_3-9-测试" class="sidebar-link">3.9 测试</a></li></ul></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_4-docker命令参考" class="sidebar-link">4. Docker命令参考</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_4-1-docker基础命令" class="sidebar-link">4.1 docker基础命令</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_4-2-docker镜像命令" class="sidebar-link">4.2 docker镜像命令</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_4-3-docker容器命令" class="sidebar-link">4.3 docker容器命令</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_4-4-docker-compose命令" class="sidebar-link">4.4 docker-compose命令</a></li></ul></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_5-docker修改data目录" class="sidebar-link">5. docker修改data目录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_5-1-显示docker目录下所有文件" class="sidebar-link">5.1 显示docker目录下所有文件</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_5-2-查看docker信息" class="sidebar-link">5.2 查看docker信息</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_5-3-创建data-root目录" class="sidebar-link">5.3 创建data-root目录</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_5-4-停止docker服务" class="sidebar-link">5.4 停止docker服务</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_5-5-编辑daemon-json" class="sidebar-link">5.5 编辑daemon.json</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_5-6-显示docker新目录下所有文件" class="sidebar-link">5.6 显示docker新目录下所有文件</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_5-7-查看docker信息" class="sidebar-link">5.7 查看docker信息</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_5-8-查看docker镜像信息" class="sidebar-link">5.8 查看docker镜像信息</a></li></ul></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_6-docker-compose" class="sidebar-link">6. docker-compose</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_6-1-官网路径" class="sidebar-link">6.1 官网路径</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_6-2-旧版安装-1-9-2" class="sidebar-link">6.2 旧版安装(1.9.2)</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_6-3-给当前用户安装" class="sidebar-link">6.3 给当前用户安装</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/normal/#_6-4-给所有用户安装-推荐" class="sidebar-link">6.4 给所有用户安装 (推荐)</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="常规部署"><a href="#常规部署" aria-hidden="true" class="header-anchor">#</a> 常规部署</h1> <ol><li>购买自己的域名</li> <li>域名备案</li> <li>购买服务器</li> <li>配置服务器应用环境</li> <li>安装配置服务器</li> <li>项目远程部署和发布与更新</li></ol> <h2 id="_1-服务器购买与备案"><a href="#_1-服务器购买与备案" aria-hidden="true" class="header-anchor">#</a> 1. 服务器购买与备案</h2> <h3 id="_1-1-购买域名"><a href="#_1-1-购买域名" aria-hidden="true" class="header-anchor">#</a> 1.1 购买域名</h3> <ul><li><a href="https://wanwang.aliyun.com/" target="_blank" rel="noopener noreferrer">阿里云<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://dnspod.cloud.tencent.com/" target="_blank" rel="noopener noreferrer">腾讯云<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://cloud.baidu.com/product/bcd.html" target="_blank" rel="noopener noreferrer">百度云<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="_1-2-云主机"><a href="#_1-2-云主机" aria-hidden="true" class="header-anchor">#</a> 1.2 云主机</h3> <ul><li><a href="https://www.aliyun.com/" target="_blank" rel="noopener noreferrer">阿里云 ECS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://aws.amazon.com/cn" target="_blank" rel="noopener noreferrer">亚马逊 AWS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://cloud.tencent.com/product/cvm" target="_blank" rel="noopener noreferrer">腾讯云<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://cloud.baidu.com/product/bcc.html" target="_blank" rel="noopener noreferrer">百度云<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>华为云(面向企业)</li> <li>google云(集成google的AI服务，尚未进入中国市场)</li></ul> <h3 id="_1-3-购买服务器（阿里云）"><a href="#_1-3-购买服务器（阿里云）" aria-hidden="true" class="header-anchor">#</a> 1.3 购买服务器（阿里云）</h3> <ul><li><a href="https://ecs-buy.aliyun.com/wizard/#/postpay/cn-beijing" target="_blank" rel="noopener noreferrer">选择配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>镜像 CentOS 7.6 64位</li></ul> <h3 id="_1-4-备案（阿里云）"><a href="#_1-4-备案（阿里云）" aria-hidden="true" class="header-anchor">#</a> 1.4 备案（阿里云）</h3> <ul><li><a href="https://beian.aliyun.com" target="_blank" rel="noopener noreferrer">阿里云备案<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://bsn.console.aliyun.com/#/bsnManagement" target="_blank" rel="noopener noreferrer">备案管理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="_2-服务器部署"><a href="#_2-服务器部署" aria-hidden="true" class="header-anchor">#</a> 2. 服务器部署</h2> <h3 id="_2-1-客户端工具"><a href="#_2-1-客户端工具" aria-hidden="true" class="header-anchor">#</a> 2.1 客户端工具</h3> <ul><li>工具下载 <a href="https://git-scm.com/downloads" target="_blank" rel="noopener noreferrer">git bash<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>推荐教程 <a href="https://www.liaoxuefeng.com/wiki/896043488029600" target="_blank" rel="noopener noreferrer">Git教程-廖雪峰的官方网站<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="_2-2-连接服务器-心跳"><a href="#_2-2-连接服务器-心跳" aria-hidden="true" class="header-anchor">#</a> 2.2 连接服务器(心跳)</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">ssh</span> root@服务器ip
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>查看系统版本</li></ul> <blockquote><p><code>lsb_release -a</code></p></blockquote> <h4 id="_2-2-1-查看客户端ssh配置"><a href="#_2-2-1-查看客户端ssh配置" aria-hidden="true" class="header-anchor">#</a> 2.2.1 查看客户端ssh配置</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /etc/ssh
<span class="token function">cat</span> ssh_config <span class="token operator">|</span> <span class="token function">grep</span> -v ^<span class="token comment"># | grep -v ^$</span>
<span class="token function">ls</span> -l
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p><code>cat ssh_config | grep -v ^# | grep -v ^$</code>: 查看配置信息<br> <code>ls -l</code>: 查看文件权限<br> <code>-rwxr--r--</code>: 所有者可读可写可执行，用户所在组只读，其他人只读<br></p></blockquote> <h4 id="_2-2-2-修改文件读写权限"><a href="#_2-2-2-修改文件读写权限" aria-hidden="true" class="header-anchor">#</a> 2.2.2 修改文件读写权限</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">600</span> ssh_config
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2-2-3-配置客户端连接检测参数"><a href="#_2-2-3-配置客户端连接检测参数" aria-hidden="true" class="header-anchor">#</a> 2.2.3 配置客户端连接检测参数</h4> <p>如果没有下边的参数，添加到配置文件末尾</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/ssh/ssh_config
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>ServerAliveInterval <span class="token number">60</span>
ServerAliveCountMax <span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p><code>ServerAliveInterval 60</code>: client每隔60秒发送一次请求给server，然后server响应，从而保持连接<br> <code>ServerAliveCountMax 3</code>: client发出请求后，服务器端没有响应得次数达到3，就自动断开连接，正常情况下，server不会不响应</p></blockquote> <h3 id="_2-3-创建非root用户"><a href="#_2-3-创建非root用户" aria-hidden="true" class="header-anchor">#</a> 2.3 创建非root用户</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>adduser zhangsan
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-4-授予权限"><a href="#_2-4-授予权限" aria-hidden="true" class="header-anchor">#</a> 2.4 授予权限</h3> <p><code>gpasswd</code>命令是Linux下工作组文件<code>/etc/group</code>和<code>/etc/gshadow</code>管理工具。</p> <blockquote><p><code>-a</code>: 添加用户到组<br> <code>-d</code>: 从组删除用户</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> gpasswd -a zhangsan
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-5-添加sudo权限"><a href="#_2-5-添加sudo权限" aria-hidden="true" class="header-anchor">#</a> 2.5 添加sudo权限</h3> <ul><li>Linux用户配置sudo权限<code>visudo</code>,如果你用<code>visudo</code>来编辑这个文件，那么它会帮你自动做很多事情，比如说语法检查，加锁防止别人同时修改这个文件等等</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> visudo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>或者</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">vi</span> /etc/sudoers
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>visudo 等价于 /etc/sudoers</p></blockquote> <p>增加以下内容</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># User privilege specification</span>
zhangsan <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL:ALL<span class="token punctuation">)</span> ALL
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>1 &quot;From ALL hosts&quot;, zhangsan 从任何机器登录，都可以应用接下来的规则</li> <li>2 &quot;Run As ALL User&quot;, zhangsan&quot;可以以任何用户的身份运行一些命令</li> <li>3 &quot;Run As All Groups&quot;, zhangsan&quot;可以以任何用户组的身份运行一些命令</li> <li>4 前面的规定适用于任何命令</li></ul> <blockquote><p><code>zhangsan</code>这个用户可以从任何机器登录，以任何用户和用户组的身份运行任何命令。 保存并退出</p></blockquote> <h3 id="_2-6-修改非root用户密码"><a href="#_2-6-修改非root用户密码" aria-hidden="true" class="header-anchor">#</a> 2.6 修改非root用户密码</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">passwd</span> zhangsan
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-7-ssh无密码登录"><a href="#_2-7-ssh无密码登录" aria-hidden="true" class="header-anchor">#</a> 2.7 SSH无密码登录</h3> <p>ssh 公钥认证是ssh认证的方式之一。通过公钥认证可实现ssh免密码登陆，git的ssh方式也是通过公钥进行认证的。</p> <h4 id="_2-7-1-本地生成公钥和私钥"><a href="#_2-7-1-本地生成公钥和私钥" aria-hidden="true" class="header-anchor">#</a> 2.7.1 本地生成公钥和私钥</h4> <ul><li>查看本地公钥私钥，如果存在不再生成</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">ls</span> -al ~/.ssh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>生成公钥和私钥</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ssh-keygen --help
<span class="token builtin class-name">cd</span> ~/.ssh
ssh-keygen -t rsa -b <span class="token number">4096</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>-t 指定加密方式<br>
-b 字节数</p></blockquote> <h4 id="_2-7-2-开启ssh代理"><a href="#_2-7-2-开启ssh代理" aria-hidden="true" class="header-anchor">#</a> 2.7.2 开启ssh代理</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">eval</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>ssh-agent -s<span class="token variable">)</span></span>&quot;</span>
ssh-add ~/.ssh/id_rsa
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>加速秘钥验证过程</p></blockquote> <h4 id="_2-7-3-服务器生成公钥和私钥"><a href="#_2-7-3-服务器生成公钥和私钥" aria-hidden="true" class="header-anchor">#</a> 2.7.3 服务器生成公钥和私钥</h4> <ul><li>1 查看公钥私钥是否存在，参考本地操作</li> <li>2 生成公钥和私钥，并开启ssh代理</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ssh-keygen -t rsa -b <span class="token number">4096</span>
<span class="token builtin class-name">eval</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>ssh-agent -s<span class="token variable">)</span></span>&quot;</span>
ssh-add ~/.ssh/id_rsa
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_2-7-4-把本地的公钥上传到服务器授权文件中"><a href="#_2-7-4-把本地的公钥上传到服务器授权文件中" aria-hidden="true" class="header-anchor">#</a> 2.7.4 把本地的公钥上传到服务器授权文件中</h4> <ul><li>1 本地查看公钥，复制<code>公钥</code></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> ~/.ssh/id_rsa.pub
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>2 上传到服务器授权文件，粘贴<code>公钥</code>到<code>authorized_keys</code></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">vi</span> ~/.ssh/authorized_keys
<span class="token function">chmod</span> <span class="token number">600</span> ~/.ssh/authorized_keys
<span class="token function">service</span> sshd restart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>可读 可写 可执行<br>
    1        1        1        (二进制)<br>
2^2 * 1 + 2^1 * 1 + 2^0 * 0 = 6  所有者权限<br>
2^2 * 0 + 2^1 * 0 + 2^0 * 0 = 0  所属组权限<br>
2^2 * 0 + 2^1 * 0 + 2^0 * 0 = 0  其他人权限<br>
chmod 600 &gt;&gt; 所有者可读可写，所属组和其他人没有任何权限</p></blockquote> <h4 id="_2-7-5-重新登录"><a href="#_2-7-5-重新登录" aria-hidden="true" class="header-anchor">#</a> 2.7.5 重新登录</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">exit</span>
<span class="token function">ssh</span> root@服务器ip
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>不再需要输入密码</p></blockquote> <h3 id="_2-8-新服务器参考"><a href="#_2-8-新服务器参考" aria-hidden="true" class="header-anchor">#</a> 2.8 <code>新服务器</code>参考</h3> <h4 id="_2-8-1-阿里云新服务器密码"><a href="#_2-8-1-阿里云新服务器密码" aria-hidden="true" class="header-anchor">#</a> 2.8.1 阿里云新服务器密码</h4> <ul><li><strong>密码: 实例密码 和 远程连接密码</strong><br>
实例密码，用于客户端连接，即本地pc的ssh命令连接工具<br>
远程连接密码(6位)，是阿里云开启web连接页面的密码</li> <li><strong>重置密码，是否需要重启?</strong><br>
实例密码，需要重启实例<br>
远程连接密码(6位)，不需要重启实例</li> <li>登录连接</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">ssh</span> root@服务器ip
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>输入<code>实例密码</code></p></blockquote> <h4 id="_2-8-2-查看-ssh-known-hosts"><a href="#_2-8-2-查看-ssh-known-hosts" aria-hidden="true" class="header-anchor">#</a> 2.8.2 查看~/.ssh/known_hosts</h4> <p>记录已经通过连接的<code>服务器+公钥</code>信息</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> ~/.ssh/known_hosts
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>当第一次没有登录成功，不知道<code>公钥</code>是否被记录，可通过这个命令查看<br>
使用<code>vim ~/.ssh/known_hosts</code>删除被错误记录的<code>公钥</code><br></p></blockquote> <h4 id="_2-8-3-其他登录方案-不推荐"><a href="#_2-8-3-其他登录方案-不推荐" aria-hidden="true" class="header-anchor">#</a> 2.8.3 其他登录方案(不推荐)</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">ssh</span> -o <span class="token assign-left variable">StrictHostKeyChecking</span><span class="token operator">=</span>no root@服务器ip
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>StrictHostKeyChecking公钥检查参数，不检查，不使用<code>公钥</code>连接<br>
会被记录到 known_hosts</p></blockquote> <h3 id="_2-9-安装软件"><a href="#_2-9-安装软件" aria-hidden="true" class="header-anchor">#</a> 2.9 安装软件</h3> <h4 id="_2-8-1-更新系统"><a href="#_2-8-1-更新系统" aria-hidden="true" class="header-anchor">#</a> 2.8.1 更新系统</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>yum -y update   <span class="token comment"># 升级所有包同时也升级软件和系统内核</span>
yum -y upgrade  <span class="token comment"># 只升级所有包，不升级软件和系统内核</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>-y 代表所有提示 <code>yes or no ?</code> 选择默认 yes</p></blockquote> <h4 id="_2-8-2-查看依赖软件是否安装"><a href="#_2-8-2-查看依赖软件是否安装" aria-hidden="true" class="header-anchor">#</a> 2.8.2 查看依赖软件是否安装</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">wget</span> --version
<span class="token function">curl</span> --version
<span class="token function">git</span> --version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_2-8-3-安装软件"><a href="#_2-8-3-安装软件" aria-hidden="true" class="header-anchor">#</a> 2.8.3 安装软件</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>yum <span class="token function">install</span> <span class="token function">wget</span> <span class="token function">curl</span> <span class="token function">git</span> -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>已安装的，不必重复安装</p></blockquote> <h3 id="_2-10-安装node"><a href="#_2-10-安装node" aria-hidden="true" class="header-anchor">#</a> 2.10 安装node</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">wget</span> -qO- https://raw.githubusercontent.com/creationix/nvm/v0.35.0/install.sh <span class="token operator">|</span> <span class="token function">bash</span>
<span class="token builtin class-name">.</span> /root/.bashrc
nvm <span class="token function">install</span> stable
node -v
<span class="token function">npm</span> i nrm -g
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>nvm github地址: <a href="https://github.com/nvm-sh/nvm" target="_blank" rel="noopener noreferrer">https://github.com/nvm-sh/nvm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
nvm sh脚本地址: <a href="https://github.com/nvm-sh/nvm/blob/master/install.sh" target="_blank" rel="noopener noreferrer">https://github.com/nvm-sh/nvm/blob/master/install.sh<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <br>
https://raw.githubusercontent.com/nvm-sh/nvm/master/install.sh === https://raw.githubusercontent.com/creationix/nvm/v0.35.0/install.sh<br></p></blockquote> <ul><li>命令简单解释</li></ul> <blockquote><p>第一行命令自动执行脚本，并配置环境变量<br>
. /root/.bashrc === source /root/.bashrc 使环境变量生效<br>
nvm node版本管理工具 --help查看帮助<br>
nrm node远程镜像代理工具 --help查看帮助</p></blockquote> <ul><li>查看当前npm全局安装的包</li></ul> <blockquote><p><code>npm list -g --depth=0</code></p></blockquote> <h3 id="_2-11-编写node程序"><a href="#_2-11-编写node程序" aria-hidden="true" class="header-anchor">#</a> 2.11 编写node程序</h3> <p>server.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span><span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'hello blog 3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'the server is started at port 3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>上传代码到git服务器，比如:</li></ul> <blockquote><p>https://gitee.com/zhufengpeixun/2019blog.git</p></blockquote> <h3 id="_2-12-启动程序"><a href="#_2-12-启动程序" aria-hidden="true" class="header-anchor">#</a> 2.12 启动程序</h3> <ul><li>安装pm2，进程管理器，进程异常退出时pm2会尝试重启，(守护进程运行程序)</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> pm2 -g
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>如果已安装，不必再次安装，pm2 -V查看版本</p></blockquote> <ul><li>clone项目创建server4000.js</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> ~
<span class="token function">git</span> clone https://gitee.com/zhufengpeixun/2019blog.git
<span class="token function">cp</span> server.js server4000.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>之后编辑文件，将3000部分改成4000</p></blockquote> <ul><li>启动server4000.js</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>pm2 start server4000.js --name <span class="token string">'server4000'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>启动命令: pm2 start [fileName] --name [appName]<br>
重启命令: pm2 restart [appName]<br>
查看列表: pm2 list<br>
停止命令: pm2 stop [appName]<br>
删除命令: pm2 delete [appName]<br></p></blockquote> <ul><li>访问4000端口
访问 <a href="http://127.0.0.1:4000" target="_blank" rel="noopener noreferrer">http://127.0.0.1:4000<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 或者使用命令</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> http://127.0.0.1:4000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>查看进程</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> node
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>node 为查看的关键字</p></blockquote> <ul><li>杀死进程(比如处理端口被占用)</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">kill</span> -9 <span class="token punctuation">[</span>pid<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-13-nginx"><a href="#_2-13-nginx" aria-hidden="true" class="header-anchor">#</a> 2.13 nginx</h3> <p><code>Nginx</code>是一个高性能的<code>HTTP</code>和反向代理服务器</p> <h4 id="_2-13-1-nginx安装"><a href="#_2-13-1-nginx安装" aria-hidden="true" class="header-anchor">#</a> 2.13.1 nginx安装</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>yum <span class="token function">install</span> nginx -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2-13-2-nginx命令"><a href="#_2-13-2-nginx命令" aria-hidden="true" class="header-anchor">#</a> 2.13.2 nginx命令</h4> <ul><li>启动nginx: <code>nginx -c /etc/nginx/nginx.conf</code></li> <li>关闭nginx: <code>nginx -s stop</code></li> <li>重读配置文件: <code>nginx -s reload</code></li></ul> <h4 id="_2-13-3-nginx配置"><a href="#_2-13-3-nginx配置" aria-hidden="true" class="header-anchor">#</a> 2.13.3 nginx配置</h4> <ul><li>查看配置文件</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> /etc/nginx/nginx.conf <span class="token operator">|</span> <span class="token function">grep</span> -v ^<span class="token comment"># | grep -v ^$</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>| grep -v ^# | grep -v ^$ 排除所有 # 开头的行，排除所有空行</p></blockquote> <ul><li>配置conf</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /etc/nginx/conf.d/
<span class="token function">vi</span> blog.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>upstream blog<span class="token punctuation">{</span>
    server <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">3000</span><span class="token punctuation">;</span>
    server <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">4000</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
server <span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name <span class="token punctuation">[</span>外网ip或域名<span class="token punctuation">]</span><span class="token punctuation">;</span>
    location <span class="token operator">/</span> <span class="token punctuation">{</span>
        proxy_pass http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>blog<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p>配置后，如果没有启动nginx，需要执行 <code>nginx -s reload</code></p></blockquote> <ul><li>查看端口使用情况</li></ul> <blockquote><p><code>netstat -lnpt | grep 80</code></p></blockquote> <ul><li>异常处理</li></ul> <blockquote><p>nginx: [error] open() &quot;/run/nginx.pid&quot; failed<br>
nginx.conf 中配置了pid /run/nginx.pid<br>
发现并没有/run/nginx.pid这个文件<br>
1, <code>ps -ef | grep nginx</code> 得到pid 比如20926<br>
2, <code>vi /run/nginx.pid</code> 将20926赋值进去<br>
3, <code>nginx -s reload</code></p></blockquote> <h3 id="_2-14-nginx常规配置参考"><a href="#_2-14-nginx常规配置参考" aria-hidden="true" class="header-anchor">#</a> 2.14 nginx常规配置参考</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>user  nginx<span class="token punctuation">;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

events <span class="token punctuation">{</span>
  worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
  include       mime<span class="token punctuation">.</span>types<span class="token punctuation">;</span>
  default_type  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>

  sendfile        on<span class="token punctuation">;</span>
  keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

  # 不推荐的配置方法
  server<span class="token punctuation">{</span>
    listen  <span class="token number">8090</span><span class="token punctuation">;</span>
    server_name <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">:</span><span class="token number">8090</span><span class="token punctuation">;</span>
    location <span class="token operator">/</span> <span class="token punctuation">{</span>
      root <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>opt<span class="token operator">/</span>nginx<span class="token operator">/</span>web_dist<span class="token punctuation">;</span>
      index index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
      try_files $uri $uri<span class="token operator">/</span> <span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  server<span class="token punctuation">{</span>
    listen  <span class="token number">80</span><span class="token punctuation">;</span>

    # ip<span class="token punctuation">:</span>port 或 域名
    server_name <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">:</span><span class="token number">80</span><span class="token punctuation">;</span>

    # 比如，公众号要求 txt文件安全认证
    location <span class="token operator">~</span><span class="token operator">*</span> <span class="token punctuation">.</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
      root <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>opt<span class="token operator">/</span>nginx<span class="token operator">/</span>txt<span class="token operator">/</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    # 不缓存页面
    location <span class="token operator">/</span>hello<span class="token operator">-</span>world <span class="token punctuation">{</span>
        alias <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>opt<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">/</span>hello<span class="token operator">-</span>world<span class="token operator">/</span><span class="token punctuation">;</span>
        add_header Last<span class="token operator">-</span>Modified $date_gmt<span class="token punctuation">;</span>
        expires <span class="token operator">-</span><span class="token number">1</span>s<span class="token punctuation">;</span>
        index index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        try_files $uri $uri<span class="token operator">/</span> <span class="token operator">/</span>hello<span class="token operator">-</span>world<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    # 跨域请求
    location <span class="token operator">/</span><span class="token keyword">static</span> <span class="token punctuation">{</span>
      add_header Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Origin <span class="token operator">*</span><span class="token punctuation">;</span>
      add_header Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Credentials <span class="token string">'true'</span><span class="token punctuation">;</span>
      add_header Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Methods <span class="token string">'GET, POST, OPTIONS'</span><span class="token punctuation">;</span>
      add_header Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Headers <span class="token string">'DNT,web-token,app-token,Authorization,Accept,Origin,Keep-Alive,User-Agent,X-Mx-ReqToken,X-Data-Type,X-Auth-Token,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range'</span><span class="token punctuation">;</span>
      add_header Access<span class="token operator">-</span>Control<span class="token operator">-</span>Expose<span class="token operator">-</span>Headers <span class="token string">'Content-Length,Content-Range'</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>$request_method <span class="token operator">=</span> <span class="token string">'OPTIONS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        add_header <span class="token string">'Access-Control-Max-Age'</span> <span class="token number">1728000</span><span class="token punctuation">;</span>
        add_header <span class="token string">'Content-Type'</span> <span class="token string">'text/plain; charset=utf-8'</span><span class="token punctuation">;</span>
        add_header <span class="token string">'Content-Length'</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">204</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      root <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>opt<span class="token operator">/</span>nginx<span class="token operator">/</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    # <span class="token operator">/</span> 放到最后
    location <span class="token operator">/</span> <span class="token punctuation">{</span>
      root <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>opt<span class="token operator">/</span>nginx<span class="token punctuation">;</span>
      index index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
      try_files $uri $uri<span class="token operator">/</span> <span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><ul><li>打包方式</li></ul> <ol><li><strong>web_dist</strong> 项目使用绝对路径 (配合 8090 端口)，不推荐</li> <li><strong>mobile</strong> 项目使用相对路径<br>
publicPath: './' （或 publicPath: ''）<br></li> <li><strong>推荐</strong> <strong>hello-world</strong> 项目使用绝对路径<br>
publicPath: '/hello-world'<br> <strong>推荐该方式</strong>，相比于<code>2</code>，可以更好地配置请求路径，如public文件夹下的文件等。</li></ol> <ul><li>访问地址(部署后最终效果)</li></ul> <ol><li>http://192.168.3.2 =&gt; nginx首页</li> <li>http://192.168.3.2:8090 =&gt; web_dist项目</li> <li>http://192.168.3.2/mobile =&gt; mobile项目</li> <li>http://1926.168.3.2/hello-world =&gt; hello-world项目</li></ol> <h2 id="_3-docker"><a href="#_3-docker" aria-hidden="true" class="header-anchor">#</a> 3. Docker</h2> <ul><li>Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的镜像中，然后发布到任何流行的 Linux或Windows 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口</li></ul> <h3 id="_3-1-docker版本"><a href="#_3-1-docker版本" aria-hidden="true" class="header-anchor">#</a> 3.1 docker版本</h3> <ul><li>docker分为企业版(EE)和社区版(CE)</li> <li>docker-ce社区版地址: <a href="https://docs.docker.com/install/linux/docker-ce/centos/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/install/linux/docker-ce/centos/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>docker-hub镜像中心地址: <a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">https://hub.docker.com/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="_3-2-docker安装"><a href="#_3-2-docker安装" aria-hidden="true" class="header-anchor">#</a> 3.2 docker安装</h3> <h4 id="_3-2-1-卸载旧版本"><a href="#_3-2-1-卸载旧版本" aria-hidden="true" class="header-anchor">#</a> 3.2.1 卸载旧版本</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>yum remove docker <span class="token punctuation">\</span>
                docker-client <span class="token punctuation">\</span>
                docker-client-latest <span class="token punctuation">\</span>
                docker-common <span class="token punctuation">\</span>
                docker-latest <span class="token punctuation">\</span>
                docker-latest-logrotate <span class="token punctuation">\</span>
                docker-logrotate <span class="token punctuation">\</span>
                docker-engine
<span class="token function">rm</span> -rf /var/lib/docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>卸载需谨慎，请先查看</p></blockquote> <h4 id="_3-2-2-安装"><a href="#_3-2-2-安装" aria-hidden="true" class="header-anchor">#</a> 3.2.2 安装</h4> <div class="language-bash line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br></div><pre class="language-bash"><code>yum <span class="token function">install</span> -y yum-utils device-mapper-persistent-data lvm2
yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
yum <span class="token function">install</span> -y docker-ce docker-ce-cli containerd.io
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>device-mapper-persistent-data: 存储驱动，Linux上的许多高级卷管理技术 lvm: 逻辑卷管理器，用于创建逻辑磁盘分区使用</p></blockquote> <h4 id="_3-2-3-优化安装"><a href="#_3-2-3-优化安装" aria-hidden="true" class="header-anchor">#</a> 3.2.3 优化安装</h4> <div class="language-bash line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-bash"><code>yum <span class="token function">install</span> -y yum-utils device-mapper-persistent-data lvm2
<span class="token function">sudo</span> yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
yum <span class="token function">install</span> -y docker-ce
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>使用阿里云镜像安装<br>
只安装<code>docker-ce</code></p></blockquote> <h4 id="_3-2-3-常见异常"><a href="#_3-2-3-常见异常" aria-hidden="true" class="header-anchor">#</a> 3.2.3 常见异常</h4> <ul><li>在执行<code>3.2.2</code>第2行时，有时会出现异常</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>&quot;Could not resolve host: download.docker.com; 未知的错误&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>原因在于首次请求docker地址，无法直接下载</p></blockquote> <ul><li>解决方法</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> https://download.docker.com/linux/centos/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><ol><li>先请求通docker地址，会返回网页内容<br></li> <li>然后可以执行<code>3.2.2</code>第2行和第3行命令</li></ol></blockquote> <h4 id="_3-2-4-其他安装方式参考"><a href="#_3-2-4-其他安装方式参考" aria-hidden="true" class="header-anchor">#</a> 3.2.4 其他安装方式参考</h4> <p>建议使用3.2.2官方提供方式</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">wget</span> -qO- https://get.docker.com <span class="token operator">|</span> <span class="token function">sh</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>关键词</li></ul> <blockquote><p>sudo 给普通用户root权限，便于安装<br>
wget 下载命令（常见的curl属于另一种）<br>
-q 简化模式，简化太多输出<br>
O- 输出依赖，依赖标准模式，不依赖简单文件系统<br>
sh 管道，将命令发送给shell，利用shell运行</p></blockquote> <ul><li>添加用户到docker组，允许普通用户使用docker</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">usermod</span> -aG docker <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-3-启动docker"><a href="#_3-3-启动docker" aria-hidden="true" class="header-anchor">#</a> 3.3 启动docker</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>systemctl start docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-4-查看docker信息"><a href="#_3-4-查看docker信息" aria-hidden="true" class="header-anchor">#</a> 3.4 查看docker信息</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker info
docker version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3-5-docker架构"><a href="#_3-5-docker架构" aria-hidden="true" class="header-anchor">#</a> 3.5 Docker架构</h3> <p><img src="/fe-blog/assets/img/docker-arch.c4971390.jpg" alt="docker-arch"></p> <h3 id="_3-6-阿里云加速"><a href="#_3-6-阿里云加速" aria-hidden="true" class="header-anchor">#</a> 3.6 阿里云加速</h3> <ul><li>镜像仓库: <a href="https://dev.aliyun.com/search.html" target="_blank" rel="noopener noreferrer">https://dev.aliyun.com/search.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>镜像加速器: <a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" target="_blank" rel="noopener noreferrer">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>配置加速器镜像</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">mkdir</span> -p /etc/docker
<span class="token function">sudo</span> <span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;-</span><span class="token string">'EOF'
{
  &quot;registry-mirrors&quot;: [&quot;https://fwvjnv59.mirror.aliyuncs.com&quot;]
}
EOF</span>
<span class="token function">sudo</span> systemctl daemon-reload
<span class="token function">sudo</span> systemctl restart docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>其中 https://fwvjnv59.mirror.aliyuncs.com 可以通过<code>镜像加速器</code>链接找到，即镜像加速器地址</p></blockquote> <h3 id="_3-7-服务启动解析"><a href="#_3-7-服务启动解析" aria-hidden="true" class="header-anchor">#</a> 3.7 服务启动解析</h3> <ul><li>运行镜像并执行命令</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker run ubuntu /bin/echo <span class="token string">&quot;Hello world&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>docker: Docker 的二进制执行文件<br>
run: 与前面的 docker 组合来运行一个容器<br>
ubuntu指定要运行的镜像，Docker首先从本地主机上查找镜像是否存在，如果不存在，Docker 就会从镜像仓库 Docker Hub 下载公共镜像<br>
/bin/echo &quot;Hello world&quot;: 在启动的容器里执行的命令</p></blockquote> <ul><li>运行新镜像并启动bash脚本</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker container run -p <span class="token number">3333</span>:3000 -it zhufengblog /bin/bash
<span class="token function">npm</span> start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>-p 参数是将容器的3000端口映射为本机的3333端口<br>
-it 参数是将容器的shell容器映射为当前的shell,在本机容器中执行的命令都会发送到容器当中执行
zhufengblog image的名称<br>
/bin/bash 容器启动后执行的第一个命令,这里是启动了bash容器以便执行脚本</p></blockquote> <h3 id="_3-8-启动node服务"><a href="#_3-8-启动node服务" aria-hidden="true" class="header-anchor">#</a> 3.8 启动node服务</h3> <h4 id="_3-8-1-创建目录及server-js文件"><a href="#_3-8-1-创建目录及server-js文件" aria-hidden="true" class="header-anchor">#</a> 3.8.1 创建目录及server.js文件</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> ~
<span class="token function">mkdir</span> dockerenv
<span class="token builtin class-name">cd</span> dockerenv/
<span class="token function">mkdir</span> app
<span class="token builtin class-name">cd</span> <span class="token function">mkdir</span> app
<span class="token function">vi</span> server.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>将server.js内容粘贴进server.js<br>
pwd命令显示为 /root/dockerenv/app</p></blockquote> <ul><li>初始化app目录为npm目录</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> i -y
<span class="token function">cat</span> package.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>编辑并确保 npm start 运行 node server.js</p></blockquote> <h4 id="_3-8-2-dockerfile"><a href="#_3-8-2-dockerfile" aria-hidden="true" class="header-anchor">#</a> 3.8.2 Dockerfile</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> ~/dockerenv/
<span class="token function">vi</span> Dockerfile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">FROM</span> node
<span class="token constant">COPY</span> <span class="token punctuation">.</span><span class="token operator">/</span>app <span class="token operator">/</span>app
<span class="token constant">WORKDIR</span> <span class="token operator">/</span>app
<span class="token constant">RUN</span> npm install
<span class="token constant">EXPOSE</span> <span class="token number">3000</span>
<span class="token constant">CMD</span> npm start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>FROM 表示该镜像继承的镜像 :表示标签<br>
COPY 是将当前目录下的app目录下面的文件都拷贝到image里的/app目录中<br>
WORKDIR 指定工作路径，类似于执行 cd 命令<br>
RUN命令在 image 文件的构建阶段执行,RUN npm install 在/app目录下安装依赖，安装后的依赖也会打包到image目录中<br>
EXPOSE 暴露3000端口，允许外部连接这个端口<br>
CMD命令在容器启动后执行<br></p></blockquote> <blockquote><p><em>一个 Dockerfile 可以包含多个RUN命令，但是只能有一个CMD命令</em><br> <em>指定了CMD命令以后，docker container run命令就不能附加命令了(比如前面的/bin/bash),否则它会覆盖CMD命令</em></p></blockquote> <h4 id="_3-8-3-创建image"><a href="#_3-8-3-创建image" aria-hidden="true" class="header-anchor">#</a> 3.8.3 创建image</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker build -t zhufengblog <span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>-t用来指定image镜像的名称，后面还可以加冒号指定标签，如果不指定默认就是latest<br>
. 表示Dockerfile文件的所有路径,.就表示当前路径</p></blockquote> <h4 id="_3-8-4-启动容器"><a href="#_3-8-4-启动容器" aria-hidden="true" class="header-anchor">#</a> 3.8.4 启动容器</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker run -d -p <span class="token number">3000</span>:3000 zhufengblog
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>-d 以后台方式运行，即退出当前用户命令链接，容器不会死掉<br>
-p 端口映射 :右边 --映射为--&gt; 左边:</p> <blockquote><p>冒号左边是外网访问端口，冒号右边是docker容器端口</p></blockquote></blockquote> <h3 id="_3-9-测试"><a href="#_3-9-测试" aria-hidden="true" class="header-anchor">#</a> 3.9 测试</h3> <ul><li>前边已经配置好nginx</li> <li>pm2方式已经启动server4000</li> <li>开启浏览器输入 http://ip</li> <li>如当前为3000，开启浏览器新标签页，会变成4000</li></ul> <div class="language-flow line-numbers-mode"><pre class="language-flow"><code>nginx 
  <span class="token operator">|</span>   <span class="token operator">=&gt;</span> server3000 <span class="token operator">=&gt;</span> <span class="token function">docker</span><span class="token punctuation">(</span>zhufengblog<span class="token punctuation">)</span>
  <span class="token operator">|</span>   <span class="token operator">=&gt;</span> server4000 <span class="token operator">=&gt;</span> <span class="token function">pm2</span><span class="token punctuation">(</span>server4000<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_4-docker命令参考"><a href="#_4-docker命令参考" aria-hidden="true" class="header-anchor">#</a> 4. Docker命令参考</h2> <h3 id="_4-1-docker基础命令"><a href="#_4-1-docker基础命令" aria-hidden="true" class="header-anchor">#</a> 4.1 docker基础命令</h3> <ul><li>查看docker volume帮助</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker volumn --help
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>volumn可以将数据及配置等，持久化的挂载到docker/volumns上</p></blockquote> <ul><li><strong>进入docker容器</strong></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker <span class="token builtin class-name">exec</span> -it <span class="token punctuation">[</span>container-id<span class="token punctuation">]</span> /bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>-it将docker容器shell映射到当前主机<br>
[container-id]或者[image-name]都可执行<br>
/bin/bash可以简写成bash，代表进入容器后运行bash</p></blockquote> <ul><li>根据DockerFile创建镜像</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker build -t hello_docker <span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>-t 给镜像添加标签<br>
.  根据当前目录的所有 Dockerfile 文件创建镜像</p></blockquote> <h3 id="_4-2-docker镜像命令"><a href="#_4-2-docker镜像命令" aria-hidden="true" class="header-anchor">#</a> 4.2 docker镜像命令</h3> <ul><li>查看镜像</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker images
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>拉取镜像</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker pull gitlab/gitlab-ce:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>daemon方式运行镜像</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker run -p <span class="token number">8080</span>:80 -d nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>-p 端口映射 80 --映射为--&gt; 8080<br>
-d 以后台方式运行，即退出当前用户命令链接，容器不会死掉</p></blockquote> <ul><li>删除镜像</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker rmi <span class="token punctuation">[</span>image-id<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_4-3-docker容器命令"><a href="#_4-3-docker容器命令" aria-hidden="true" class="header-anchor">#</a> 4.3 docker容器命令</h3> <ul><li>查看运行中的容器</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker <span class="token function">ps</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>查看所有容器</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker <span class="token function">ps</span> -a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>删除容器</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker <span class="token function">rm</span> <span class="token punctuation">[</span>container-id<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>停止容器</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker stop <span class="token punctuation">[</span>container-id<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>将容器提交成镜像</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker commit -m <span class="token string">'message'</span> <span class="token punctuation">[</span>container-id<span class="token punctuation">]</span> <span class="token punctuation">[</span>image-name<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>拷贝文件到容器</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker <span class="token function">cp</span> <span class="token punctuation">[</span>fileName<span class="token punctuation">]</span> <span class="token punctuation">[</span>container-id<span class="token punctuation">]</span>://usr/share/nginx/html
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_4-4-docker-compose命令"><a href="#_4-4-docker-compose命令" aria-hidden="true" class="header-anchor">#</a> 4.4 docker-compose命令</h3> <p>docker多容器管理</p> <ul><li>创建文件</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> ~/dockerenv/compose
<span class="token function">touch</span> docker-compose.yml
<span class="token function">vim</span> docker-compose.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>创建后，编写相关配置<br>
cd 到 docker-compose.yml 目录下</p></blockquote> <ul><li>运行</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker-compose up -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>停止</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker-compose stop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>删除</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker-compose <span class="token function">rm</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>构建</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker-compose build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>查看日志</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker-compose logs -f
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_5-docker修改data目录"><a href="#_5-docker修改data目录" aria-hidden="true" class="header-anchor">#</a> 5. docker修改data目录</h2> <ul><li><a href="https://docs.docker.com/config/daemon/systemd/#custom-docker-daemon-options" target="_blank" rel="noopener noreferrer">修改daemon.json<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>为了减少系统磁盘压力，可以将docker镜像、容器、volumes放到挂载的目录(/mnt/data/docker)</li></ul> <h3 id="_5-1-显示docker目录下所有文件"><a href="#_5-1-显示docker目录下所有文件" aria-hidden="true" class="header-anchor">#</a> 5.1 显示docker目录下所有文件</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">du</span> /var/lib/docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_5-2-查看docker信息"><a href="#_5-2-查看docker信息" aria-hidden="true" class="header-anchor">#</a> 5.2 查看docker信息</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker info
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>Storage Driver: overlay2<br>
Docker Root Dir: /var/lib/docker<br>
Registry Mirrors: https://21f73xp7.mirror.aliyuncs.com/<br></p></blockquote> <h3 id="_5-3-创建data-root目录"><a href="#_5-3-创建data-root目录" aria-hidden="true" class="header-anchor">#</a> 5.3 创建data-root目录</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> /mnt/data/docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>如果docker中已经有镜像，需要执行拷贝</li></ul> <blockquote><p>cp /var/lib/docker /mnt/data/docker</p></blockquote> <h3 id="_5-4-停止docker服务"><a href="#_5-4-停止docker服务" aria-hidden="true" class="header-anchor">#</a> 5.4 停止docker服务</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>systemctl stop docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_5-5-编辑daemon-json"><a href="#_5-5-编辑daemon-json" aria-hidden="true" class="header-anchor">#</a> 5.5 编辑daemon.json</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /etc/docker/daemon.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;registry-mirrors&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://21f73xp7.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;data-root&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;/mnt/data/docker&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;storage-driver&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;overlay2&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p><code>overlay2</code>来自<code>docker info</code>的信息</p></blockquote> <h3 id="_5-6-显示docker新目录下所有文件"><a href="#_5-6-显示docker新目录下所有文件" aria-hidden="true" class="header-anchor">#</a> 5.6 显示docker新目录下所有文件</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">du</span> /mnt/data/docker/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_5-7-查看docker信息"><a href="#_5-7-查看docker信息" aria-hidden="true" class="header-anchor">#</a> 5.7 查看docker信息</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker info
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>Docker Root Dir: /mnt/data/docker<br></p></blockquote> <h3 id="_5-8-查看docker镜像信息"><a href="#_5-8-查看docker镜像信息" aria-hidden="true" class="header-anchor">#</a> 5.8 查看docker镜像信息</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker inspect <span class="token punctuation">[</span>image-id<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>最后看到镜像对应路径为<code>新路径</code></p></blockquote> <h2 id="_6-docker-compose"><a href="#_6-docker-compose" aria-hidden="true" class="header-anchor">#</a> 6. docker-compose</h2> <p>docker-compose安装的前提是先安装<code>docker</code></p> <h3 id="_6-1-官网路径"><a href="#_6-1-官网路径" aria-hidden="true" class="header-anchor">#</a> 6.1 官网路径</h3> <p>github地址：<a href="https://github.com/docker/compose" target="_blank" rel="noopener noreferrer">https://github.com/docker/compose<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
官方文档：<a href="https://docs.docker.com/compose/cli-command/#install-on-linux" target="_blank" rel="noopener noreferrer">https://docs.docker.com/compose/cli-command/#install-on-linux<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
yml文件格式与内核关系：<a href="https://docs.docker.com/compose/compose-file/compose-file-v3/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/compose/compose-file/compose-file-v3/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_6-2-旧版安装-1-9-2"><a href="#_6-2-旧版安装-1-9-2" aria-hidden="true" class="header-anchor">#</a> 6.2 旧版安装(1.9.2)</h3> <div class="language-bash line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br></div><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">curl</span> -L <span class="token string">&quot;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -s<span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -m<span class="token variable">)</span></span>&quot;</span> -o /usr/local/bin/docker-compose
<span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose
docker-compose --version
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>命令使用<code>docker-compose</code>，而新版里使用<code>docker compose</code></p></blockquote> <h3 id="_6-3-给当前用户安装"><a href="#_6-3-给当前用户安装" aria-hidden="true" class="header-anchor">#</a> 6.3 给当前用户安装</h3> <ul><li>查看版本信息
<a href="https://github.com/docker/compose/releases" target="_blank" rel="noopener noreferrer">https://github.com/docker/compose/releases<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>安装（<code>v2.2.3</code>举例）</li></ul> <div class="language-bash line-numbers-mode"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br></div><pre class="language-bash"><code><span class="token function">mkdir</span> -p ~/.docker/cli-plugins/
<span class="token function">curl</span> -SL https://github.com/docker/compose/releases/download/v2.2.3/docker-compose-linux-x86_64 -o ~/.docker/cli-plugins/docker-compose
<span class="token function">chmod</span> +x ~/.docker/cli-plugins/docker-compose
docker compose version
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_6-4-给所有用户安装-推荐"><a href="#_6-4-给所有用户安装-推荐" aria-hidden="true" class="header-anchor">#</a> 6.4 给所有用户安装 <strong>(推荐)</strong></h3> <div class="language-bash line-numbers-mode"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br></div><pre class="language-bash"><code><span class="token function">mkdir</span> -p /usr/local/lib/docker/cli-plugins
<span class="token function">curl</span> -SL https://github.com/docker/compose/releases/download/v2.2.3/docker-compose-linux-x86_64 -o /usr/local/lib/docker/cli-plugins/docker-compose
<span class="token function">chmod</span> +x /usr/local/lib/docker/cli-plugins/docker-compose
docker compose version
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/11/2022, 12:53:56 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/fe-blog/assets/js/app.8a3559bf.js" defer></script><script src="/fe-blog/assets/js/2.fbf19223.js" defer></script><script src="/fe-blog/assets/js/18.99786a0e.js" defer></script>
  </body>
</html>
