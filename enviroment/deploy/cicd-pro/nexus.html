<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nexus | jasvtfvan前端博客</title>
    <meta name="description" content="欢迎来到我的前端工厂">
    <link rel="icon" href="/fe-blog/github.ico">
    
    <link rel="preload" href="/fe-blog/assets/css/0.styles.68cfcd3e.css" as="style"><link rel="preload" href="/fe-blog/assets/js/app.8a3559bf.js" as="script"><link rel="preload" href="/fe-blog/assets/js/2.fbf19223.js" as="script"><link rel="preload" href="/fe-blog/assets/js/5.7519b52c.js" as="script"><link rel="prefetch" href="/fe-blog/assets/js/10.399f0c01.js"><link rel="prefetch" href="/fe-blog/assets/js/11.08202412.js"><link rel="prefetch" href="/fe-blog/assets/js/12.cfc10ac9.js"><link rel="prefetch" href="/fe-blog/assets/js/13.bdceb3a3.js"><link rel="prefetch" href="/fe-blog/assets/js/14.0c886dba.js"><link rel="prefetch" href="/fe-blog/assets/js/15.f5d42d2e.js"><link rel="prefetch" href="/fe-blog/assets/js/16.19c927b2.js"><link rel="prefetch" href="/fe-blog/assets/js/17.cc368339.js"><link rel="prefetch" href="/fe-blog/assets/js/18.99786a0e.js"><link rel="prefetch" href="/fe-blog/assets/js/19.2c96aa8f.js"><link rel="prefetch" href="/fe-blog/assets/js/20.feb358f9.js"><link rel="prefetch" href="/fe-blog/assets/js/21.854b8672.js"><link rel="prefetch" href="/fe-blog/assets/js/22.78adf0af.js"><link rel="prefetch" href="/fe-blog/assets/js/23.a8c123d2.js"><link rel="prefetch" href="/fe-blog/assets/js/24.65de2737.js"><link rel="prefetch" href="/fe-blog/assets/js/25.21f6581b.js"><link rel="prefetch" href="/fe-blog/assets/js/26.19b2e629.js"><link rel="prefetch" href="/fe-blog/assets/js/27.b0579100.js"><link rel="prefetch" href="/fe-blog/assets/js/28.a0c1bad8.js"><link rel="prefetch" href="/fe-blog/assets/js/29.3869f6fd.js"><link rel="prefetch" href="/fe-blog/assets/js/3.a5dd7d81.js"><link rel="prefetch" href="/fe-blog/assets/js/30.be6becb7.js"><link rel="prefetch" href="/fe-blog/assets/js/31.e027926c.js"><link rel="prefetch" href="/fe-blog/assets/js/32.dd112bea.js"><link rel="prefetch" href="/fe-blog/assets/js/33.2cdeb0bd.js"><link rel="prefetch" href="/fe-blog/assets/js/34.2eb22cbc.js"><link rel="prefetch" href="/fe-blog/assets/js/35.a1660bb3.js"><link rel="prefetch" href="/fe-blog/assets/js/36.3d49d679.js"><link rel="prefetch" href="/fe-blog/assets/js/37.2c728d3e.js"><link rel="prefetch" href="/fe-blog/assets/js/38.5b00cff3.js"><link rel="prefetch" href="/fe-blog/assets/js/39.bc2ccb29.js"><link rel="prefetch" href="/fe-blog/assets/js/4.54c72001.js"><link rel="prefetch" href="/fe-blog/assets/js/40.fe52d14c.js"><link rel="prefetch" href="/fe-blog/assets/js/41.da19c7de.js"><link rel="prefetch" href="/fe-blog/assets/js/42.82780c8a.js"><link rel="prefetch" href="/fe-blog/assets/js/43.ea864644.js"><link rel="prefetch" href="/fe-blog/assets/js/44.683e33ca.js"><link rel="prefetch" href="/fe-blog/assets/js/45.6ebdb1c6.js"><link rel="prefetch" href="/fe-blog/assets/js/46.d152d9d1.js"><link rel="prefetch" href="/fe-blog/assets/js/6.60bc9110.js"><link rel="prefetch" href="/fe-blog/assets/js/7.583a8196.js"><link rel="prefetch" href="/fe-blog/assets/js/8.b04d2cae.js"><link rel="prefetch" href="/fe-blog/assets/js/9.f4b536f6.js">
    <link rel="stylesheet" href="/fe-blog/assets/css/0.styles.68cfcd3e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fe-blog/" class="home-link router-link-active"><!----> <span class="site-name">jasvtfvan前端博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fe-blog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">微信平台</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>公众号</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/wechat/serviceaccount/local-debug.html" class="nav-link">本地调试</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">javascript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-blog/javascript/regexp/" class="nav-link">正则表达式</a></li><li class="dropdown-item"><!----> <a href="/fe-blog/javascript/highlights/" class="nav-link">基础集锦</a></li><li class="dropdown-item"><!----> <a href="/fe-blog/javascript/promise/" class="nav-link">promise</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">主流框架</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>vue2</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/frame/vue2/source/observer.html" class="nav-link">框架源码</a></li><li class="dropdown-subitem"><a href="/fe-blog/frame/vue2/application/base.html" class="nav-link">框架应用</a></li></ul></li><li class="dropdown-item"><h4>react</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/frame/react15/source/native.html" class="nav-link">react15源码</a></li><li class="dropdown-subitem"><a href="/fe-blog/frame/react16/source/fiber.html" class="nav-link">react16源码</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具环境</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/enviroment/tools/git/" class="nav-link">git/git-flow</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/tools/node/" class="nav-link">node工具</a></li></ul></li><li class="dropdown-item"><h4>系统</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/enviroment/os/centos/mnt.html" class="nav-link">centOS</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/os/centos/cmd.html" class="nav-link">linux常用命令</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/os/mac/switch-hosts.html" class="nav-link">mac技巧</a></li></ul></li><li class="dropdown-item"><h4>部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/normal/" class="nav-link">常规部署</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/cicd/" class="nav-link">CI/CD</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/gitlab/" class="nav-link">gitlab搭建</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/docker/" class="nav-link">docker常用容器</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/cicd-pro/cicd.html" class="nav-link">CI/CD综合</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fe-blog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">微信平台</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>公众号</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/wechat/serviceaccount/local-debug.html" class="nav-link">本地调试</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">javascript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-blog/javascript/regexp/" class="nav-link">正则表达式</a></li><li class="dropdown-item"><!----> <a href="/fe-blog/javascript/highlights/" class="nav-link">基础集锦</a></li><li class="dropdown-item"><!----> <a href="/fe-blog/javascript/promise/" class="nav-link">promise</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">主流框架</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>vue2</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/frame/vue2/source/observer.html" class="nav-link">框架源码</a></li><li class="dropdown-subitem"><a href="/fe-blog/frame/vue2/application/base.html" class="nav-link">框架应用</a></li></ul></li><li class="dropdown-item"><h4>react</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/frame/react15/source/native.html" class="nav-link">react15源码</a></li><li class="dropdown-subitem"><a href="/fe-blog/frame/react16/source/fiber.html" class="nav-link">react16源码</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具环境</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/enviroment/tools/git/" class="nav-link">git/git-flow</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/tools/node/" class="nav-link">node工具</a></li></ul></li><li class="dropdown-item"><h4>系统</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/enviroment/os/centos/mnt.html" class="nav-link">centOS</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/os/centos/cmd.html" class="nav-link">linux常用命令</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/os/mac/switch-hosts.html" class="nav-link">mac技巧</a></li></ul></li><li class="dropdown-item"><h4>部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/normal/" class="nav-link">常规部署</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/cicd/" class="nav-link">CI/CD</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/gitlab/" class="nav-link">gitlab搭建</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/docker/" class="nav-link">docker常用容器</a></li><li class="dropdown-subitem"><a href="/fe-blog/enviroment/deploy/cicd-pro/cicd.html" class="nav-link">CI/CD综合</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fe-blog/enviroment/deploy/cicd-pro/cicd.html" class="sidebar-link">什么是CI/CD?</a></li><li><a href="/fe-blog/enviroment/deploy/cicd-pro/docker.html" class="sidebar-link">Docker</a></li><li><a href="/fe-blog/enviroment/deploy/cicd-pro/jenkins.html" class="sidebar-link">安装 Jenkins</a></li><li><a href="/fe-blog/enviroment/deploy/cicd-pro/gitlab.html" class="sidebar-link">安装 Gitlab</a></li><li><a href="/fe-blog/enviroment/deploy/cicd-pro/nginx.html" class="sidebar-link">Docker Nginx</a></li><li><a href="/fe-blog/enviroment/deploy/cicd-pro/jenkins-gitlab.html" class="sidebar-link">Jenkins + Gitlab</a></li><li><a href="/fe-blog/enviroment/deploy/cicd-pro/nexus.html" class="active sidebar-link">Nexus</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/cicd-pro/nexus.html#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/cicd-pro/nexus.html#拉取-neuxs-镜像" class="sidebar-link">拉取 Neuxs 镜像</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/cicd-pro/nexus.html#启动-nexus-容器" class="sidebar-link">启动 Nexus 容器</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/cicd-pro/nexus.html#访问-nexus" class="sidebar-link">访问 Nexus</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/cicd-pro/nexus.html#配置-nexus" class="sidebar-link">配置 Nexus</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/cicd-pro/nexus.html#创建一个-docker-私服" class="sidebar-link">创建一个 Docker 私服</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/cicd-pro/nexus.html#制品库的类型" class="sidebar-link">制品库的类型</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/cicd-pro/nexus.html#表单解释" class="sidebar-link">表单解释</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/cicd-pro/nexus.html#查看制品地址" class="sidebar-link">查看制品地址</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/cicd-pro/nexus.html#配置登录docker权限" class="sidebar-link">配置登录Docker权限</a></li></ul></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/cicd-pro/nexus.html#登录制品库" class="sidebar-link">登录制品库</a></li><li class="sidebar-sub-header"><a href="/fe-blog/enviroment/deploy/cicd-pro/nexus.html#推送镜像到制品库" class="sidebar-link">推送镜像到制品库</a></li></ul></li><li><a href="/fe-blog/enviroment/deploy/cicd-pro/jenkins-nexus.html" class="sidebar-link">Jenkins + Nexus</a></li><li><a href="/fe-blog/enviroment/deploy/cicd-pro/ansible.html" class="sidebar-link">Ansible</a></li><li><a href="/fe-blog/enviroment/deploy/cicd-pro/jenkins-nexus-ansible.html" class="sidebar-link">Ansible + Jenkins + Nexus</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nexus"><a href="#nexus" aria-hidden="true" class="header-anchor">#</a> Nexus</h1> <h2 id="介绍"><a href="#介绍" aria-hidden="true" class="header-anchor">#</a> 介绍</h2> <p>在前面我们写到，制品库是 <strong>承接CI构建后的产出制品的仓库</strong> 。具有版本管理，历史管理，权限校验等功能。<br>
在这里，我们选用 <strong>Nexus3</strong> 作为制品库。</p> <h2 id="拉取-neuxs-镜像"><a href="#拉取-neuxs-镜像" aria-hidden="true" class="header-anchor">#</a> 拉取 Neuxs 镜像</h2> <p>老规矩，先拉取nexus镜像。命令不多解释：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker pull sonatype/nexus3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="启动-nexus-容器"><a href="#启动-nexus-容器" aria-hidden="true" class="header-anchor">#</a> 启动 Nexus 容器</h2> <p>在 <code>/home</code> 下面新建一个名为 <code>nexus</code> 的文件夹，方便我们存放 <code>Nexus</code> 相关数据。并赋予权限</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> /home/nexus <span class="token operator">&amp;&amp;</span> <span class="token function">chown</span> -R <span class="token number">200</span> /home/nexus
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后启动容器。</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code>docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">8081</span><span class="token punctuation">:</span><span class="token number">8081</span> <span class="token operator">-</span>p <span class="token number">8082</span><span class="token punctuation">:</span><span class="token number">8082</span> \
<span class="token operator">-</span><span class="token operator">-</span>name nexus \
<span class="token operator">-</span>v <span class="token operator">/</span>home<span class="token operator">/</span>nexus<span class="token punctuation">:</span><span class="token operator">/</span>nexus<span class="token operator">-</span>data \
<span class="token operator">-</span><span class="token operator">-</span>restart always \
sonatype<span class="token operator">/</span>nexus3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>Nexus 的主服务端口是8081，但 Nexus Docker 制品库还需要分配一个新的端口作为服务端口。<br>
这里没有演示分配哪个端口，想分配自己加 -p 参数即可。在这里我使用8082作为 docker 服务端口</p></blockquote> <p>将8081，8082端口添加到防火墙规则内：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">8081</span>/tcp --permanent
firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">8082</span>/tcp --permanent
systemctl reload firewalld
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>查看防火墙生效的配置:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>firewall-cmd --list-all
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>其中可以看到 <code>8081</code> 和 <code>8082</code> 已经加入到防火墙</p></blockquote> <h2 id="访问-nexus"><a href="#访问-nexus" aria-hidden="true" class="header-anchor">#</a> 访问 Nexus</h2> <p>打开浏览器地址栏，访问 <code>Nexus</code> 的服务地址。启动时间比较长，需要耐心等待。可以使用 <code>docker logs</code> 命令查看启动日志。如果显示以下文字，代表启动成功。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker logs -f nexus
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/fe-blog/assets/img/nexus1.dd7fd62e.png" alt="image"></p> <p><img src="/fe-blog/assets/img/nexus2.669ba0c6.png" alt="image"></p> <h2 id="配置-nexus"><a href="#配置-nexus" aria-hidden="true" class="header-anchor">#</a> 配置 Nexus</h2> <p>启动成功后，会显示上图提示文字。需要我们输入 <code>默认密码</code> 初始化配置。可以在这里找到：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> /home/nexus/admin.password
<span class="token comment"># 6cd3cb39-2479-48ca-8ca0-831342b6f29d</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>将获取到的密码输入进去，用户是 <code>admin</code> 。</p> <p>修改新密码后，会进入到这一步。这一步的意思是 <strong>&quot;是否开启匿名访问&quot;</strong>。匿名访问是指：<strong>我们在任何没有登录的情况下，拉取（推送）制品到制品库，都算匿名访问。</strong> 这是个很便捷，也很危险 <code>⚠️</code> 的行为。</p> <p>例如，这个制品库也支持 node 的 <code>NPM</code> 私有库。那么我们在没有 <code>npm login</code> 这个制品库之前，就可以进行 <code>npm install</code> <code>npm publish</code> ，其实是不太安全的。那么任何一个知道制品库地址的人，都可以任意进行推送和获取资源。</p> <p><strong>这里我们为了测试，可以先允许开启匿名访问</strong>。选择 <strong>Enable</strong> <strong>anonymous</strong> <strong>access</strong> ，点击下一步。</p> <p><img src="/fe-blog/assets/img/nexus3.164b2c13.png" alt="image"></p> <h2 id="创建一个-docker-私服"><a href="#创建一个-docker-私服" aria-hidden="true" class="header-anchor">#</a> 创建一个 Docker 私服</h2> <p>我们使用有权限的账号登录后，点击页面头部导航栏的 齿轮 图标，选择左侧菜单中的 <code>Repositories</code> ，点击 <code>Create repository</code> 。</p> <p><img src="/fe-blog/assets/img/nexus4.a7cdeb12.png" alt="image"></p> <p>点击后，我们可以看到一个列表，这就是Nexus所支持的制品库类型。其中有我们要使用的Docker，也有熟悉的 Npm。我们在里面找到 Docker：</p> <p><img src="/fe-blog/assets/img/nexus5.7e05ef41.png" alt="image"></p> <p>但是 <code>Docker</code> 有三种，该选哪个呢？</p> <h3 id="制品库的类型"><a href="#制品库的类型" aria-hidden="true" class="header-anchor">#</a> 制品库的类型</h3> <p>在Nexus中，无论什么制品库，一般分为以下三种类型：</p> <ul><li><p>proxy: 此类型制品库原则上 <strong>“只下载，不允许用户推送”</strong>。可以理解为<strong>缓存外网制品的制品库</strong>。例如，我们在拉取nginx镜像时，如果通过proxy类型的制品库，则它会去创建时配置好的外网docker镜像源拉取（有点像cnpm）到自己的制品库，然后给你。第二次拉取，则不会下载。起到 <code>缓存</code> 的作用。
<br></p></li> <li><p>hosted：此类型制品库和proxy相反，原则上 <strong>”只允许用户推送，不允许缓存“</strong> 。这是私有库的核心，只存放自己的私有镜像或制品。
<br></p></li> <li><p>group：此类型制品库用作以上两种类型的 <strong>“集合”</strong> ，将上面两个库集合为一个使用。</p></li></ul> <h3 id="表单解释"><a href="#表单解释" aria-hidden="true" class="header-anchor">#</a> 表单解释</h3> <p>在这里，我们其实不需要<strong>缓存外网镜像</strong>，那么我们只需要 <strong>hosted类型</strong> 即可。选择 <strong>docker(hosted)</strong>。</p> <p>我们将启动Nexus镜像时，配置好的 Docker 端口填入HTTP 内，可以先允许匿名拉取镜像。</p> <p><img src="/fe-blog/assets/img/nexus6.7e78392d.png" alt="image"></p> <p>填写完成后，点击最下方的 Create repository，保存创建。</p> <h3 id="查看制品地址"><a href="#查看制品地址" aria-hidden="true" class="header-anchor">#</a> 查看制品地址</h3> <p>找到我们刚刚创建的制品，点击上面的 <strong>copy</strong>，查看地址。</p> <p><img src="/fe-blog/assets/img/nexus7.3572e6bf.png" alt="image"></p> <h3 id="配置登录docker权限"><a href="#配置登录docker权限" aria-hidden="true" class="header-anchor">#</a> 配置登录<code>Docker</code>权限</h3> <p>如果启动匿名拉取镜像 <code>Allow anonymous docker pull</code> 则需要配置 <code>Docker Bearer Token Realm</code> <img src="/fe-blog/assets/img/DockerAuth.0f695d73.png" alt="image"></p> <h2 id="登录制品库"><a href="#登录制品库" aria-hidden="true" class="header-anchor">#</a> 登录制品库</h2> <p>私服建设完成后，还需要在客户端配置一下才可以使用。<br>
找到 <code>daemon.json</code> 文件，该文件描述了当前docker配置的镜像加速地址，和配置过的私服地址。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">vi</span> /etc/docker/daemon.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>找到 <code>insecure-registries</code> 字段，如果不存在就自己添加一个。值是数组类型，添加一条你的制品库地址。例如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  &quot;registry-mirrors&quot;: [&quot;https://之前配置的阿里云镜像.mirror.aliyuncs.com&quot;],
  &quot;insecure-registries&quot;: [&quot;172.16.81.50:8082&quot;]
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>注意json格式，不能有多余的逗号<br>
这里注意，nexus显示的镜像库端口为nexus服务端口，要替换为自己配置的端口才有效。</p></blockquote> <p>保存退出，重启 Docker</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>systemctl daemon-reload
systemctl restart docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>接着使用 docker login 命令尝试登录：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker login 服务IP:端口
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>登录<code>login credentials</code>会记录在<code>/root/.docker/config.json</code>中<br>
如果不进行<code>docker logout 服务器ip:端口</code>操作，则服务器重启后无需再次登录</p></blockquote> <p>如果提示：<strong>Login Succeeded</strong> 则代表登录成功。</p> <p><img src="/fe-blog/assets/img/nexus8.7c515ad2.png" alt="image"></p> <h2 id="推送镜像到制品库"><a href="#推送镜像到制品库" aria-hidden="true" class="header-anchor">#</a> 推送镜像到制品库</h2> <p>在这里，我们使用 <code>docker push</code> 命令推送一个本地的镜像到远程制品库。<br>
还记得在我们前面安装 <code>Jenkins</code> 时，使用过 <code>DockerFile</code> 生成了自己的 <code>Jenkins</code> 镜像 -<code>local/jenkins</code> 。所以我们可以尝试，将 <code>local/jenkins</code> 推送到制品库。<br></p> <p>但是，docker在推送一个镜像时，<strong>镜像的 Tag (名称:版本号) 必须开头带着镜像库的地址，才可以推送</strong>。例如下面两个镜像：<br>
🙅 <strong>local/jenkins</strong> 不能推送<br>
🙆 <strong>172.16.81.150:8082/local/jenkins</strong> 可以推送。<br></p> <p>那我们怎么才能推送上去呢？</p> <ol><li><strong>制作一份带镜像库地址的镜像：这个可以做，但是开销太大，需要走一遍制作流程</strong></li> <li><strong>使用 docker</strong> <strong>tag 命令给已有的镜像打个标签：推荐使用，会将已有的镜像归位某个镜像库内。如下面格式</strong></li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># docker tag &lt;镜像ID&gt; 新镜像名称[:版本]</span>
docker tag bd695e3e4317 <span class="token number">172.16</span>.81.150:8082/local/jenkins
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>查看服务器上的docker镜像列表，可以使用docker images查看</p></blockquote> <p>这样，就可以重新打一个全新的tag，实现 “重命名” 功能。</p> <p><img src="/fe-blog/assets/img/nexus9.c58318e5.png" alt="image"></p> <p>接着我们使用 <code>docker push</code>命令进行推送：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker push <span class="token number">172.16</span>.81.150:8082/local/jenkins
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/fe-blog/assets/img/nexus10.92514dde.png" alt="image"></p> <p>到这里，就代表推送成功。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/9/2020, 9:33:22 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fe-blog/enviroment/deploy/cicd-pro/jenkins-gitlab.html" class="prev">Jenkins + Gitlab</a></span> <span class="next"><a href="/fe-blog/enviroment/deploy/cicd-pro/jenkins-nexus.html">Jenkins + Nexus</a>→
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/fe-blog/assets/js/app.8a3559bf.js" defer></script><script src="/fe-blog/assets/js/2.fbf19223.js" defer></script><script src="/fe-blog/assets/js/5.7519b52c.js" defer></script>
  </body>
</html>
